--- kernel.spec_orig	2012-11-10 18:56:46.000000000 +0400
+++ kernel.spec	2012-11-21 22:51:22.177924486 +0400
@@ -159,6 +159,21 @@
 %{?_without_kirkwood: %global build_kirkwood 0}
 %{?_without_versatile: %global build_versatile 0}
 
+%define build_modgz	0
+%{?_with_modgz: %global build_modgz 1}
+# MagOS Linux settings
+%define build_for_magos 0
+%{?_with_build_for_magos: %global build_for_magos 1}
+%if %build_for_magos
+%define mgaver          _magos
+%define build_modxz     0
+%define build_doc       0
+%define build_source    0
+%define build_debug     0
+%define build_perf      0
+%define build_cpupower  0
+%endif
+
 # For the .nosrc.rpm
 %define build_nosrc 	0
 %{?_with_nosrc: %global build_nosrc 1}
@@ -252,6 +267,10 @@ Source10: 	ftp://ftp.kernel.org/pub/linu
 %endif
 %endif
 
+%if %build_for_magos
+Patch101:       linux-%{patch_ver}-magos.patch
+%endif
+
 #END
 ####################################################################
 
@@ -281,6 +300,8 @@ processor mode, use the "nosmp" boot par
 
 Autoreqprov: 		no
 
+%if %build_for_magos
+%else
 BuildRequires: 		gcc kmod >= 7-6
 # for perf, cpufreq and other tools
 BuildRequires:		elfutils-devel
@@ -297,6 +318,7 @@ BuildRequires:		docbook-style-xsl
 BuildRequires:		pkgconfig(gtk+-2.0)
 BuildRequires:		flex
 BuildRequires:		bison
+%endif
 
 %ifarch %{arm}
 BuildRequires:		uboot-mkimage
@@ -689,6 +711,9 @@ cd %src_dir
 %if %kgit
 %patch2 -p1
 %endif
+%if %build_for_magos
+%patch101 -p1 -d %{patches_dir}
+%endif
 
 %{patches_dir}/scripts/apply_patches
 
@@ -1234,7 +1259,8 @@ rm -rf %{target_source}/.tmp_depmod/
 # compressing modules
 %if %{build_modxz}
 find %{target_modules} -name "*.ko" | %kxargs xz -6e
-%else
+%endif
+%if %{build_modgz}
 find %{target_modules} -name "*.ko" | %kxargs gzip -9
 %endif
 
